(function(l,m){"object"===typeof exports&&"undefined"!==typeof module?module.exports=m():"function"===typeof define&&define.amd?define(m):l.lemonade=m()})(this,function(){var l=null;document.lemonadejs||(l=document.lemonadejs={queue:[],container:{}});var m=function(a){return a instanceof Element||a instanceof HTMLDocument},A=function(a){return g.element(a,this)},v=function(a,c){var b,e;if(e=a.lemon){if(e.queue)for(;b=e.queue.shift();)l.queue.push(b);"function"==typeof e.self.onload&&l.queue.push(e.self.onload.bind(e.self,
a))}if(document.body.contains(c)&&l&&l.queue&&l.queue.length)for(;b=l.queue.shift();)b()},w=function(a,c,b){if("value"===b)if("function"===typeof a.val)a.val()!=c&&a.val(c);else if("SELECT"==a.tagName&&a.getAttribute("multiple"))for(b=0;b<a.children.length;b++)a.children[b].selected=0<=c.indexOf(a.children[b].value);else"checkbox"==a.type?a.checked=c&&"0"!==c&&"false"!==c?!0:!1:"radio"==a.type?(a.checked=!1,a.value==c&&(a.checked=!0)):a.getAttribute("contenteditable")?a.innerHTML!=c&&(a.innerHTML=
c):a.value=c;else"undefined"!==typeof a[b]||"function"==typeof c||"object"==typeof c?a[b]=c:a.setAttribute(b,c)},t=function(a,c){var b,e;if(b=this.tracking[a]){var d=this.self;for(e=0;e<b.length;e++){var f=b[e].element;var h=eval(b[e].v);var k=b[e].property;"@loop"==k?B.call(f,h,d):f.self?f.self[k]=h:w(f,h,k)}c||"function"!=typeof d.onchange||d.onchange.call(f,a,b,d)}},C=function(a){var c=this,b=!0;Object.defineProperty(this.self,a,{set:function(e){c.state[a]=e;t.call(c,a,b);b=!1},get:function(){return c.state[a]},
configurable:!0,enumerable:!0})},u=function(a,c,b){var e=eval(c.v);"undefined"===typeof e&&(e="");if("textContent"==b){var d=document.createTextNode(e);a.childNodes[0]?a.insertBefore(d,a.childNodes[0].splitText(c.p)):a.appendChild(d)}else"@loop"==b?d=a:(d=a,w(a,e,b));if((a=c.v.match(/self\.([a-zA-Z0-9_].*?)*/g))&&a.length)for(e=0;e<a.length;e++){var f=a[e].replace("self.",""),h=!1,k=this.self[f];"undefined"===typeof k&&(k="");this.tracking[f]||(this.tracking[f]=[],h=!0);this.tracking[f].push({element:d,
property:b,v:c.v});h&&C.call(this,f);this.self[f]=k}},x=function(a,c){var b=[],e=0,d=function(f,h,k,p){b.push({p:k-e,v:h});e+=f.length;return""};a.getAttribute&&a.getAttribute(c)?a.setAttribute(c,a.getAttribute(c).replace(/{{(.*?)}}/g,d)):"string"==typeof a[c]&&a[c]&&(a[c]=a[c].replace(/{{(.*?)}}/g,d));if(b.length)for(1!=b.length||"textContent"!=c||a.innerText||(c="innerHTML"),d=b.length-1;0<=d;d--)u.call(this,a,b[d],c)},y=function(a){var c={},b=this.attributes;if(b&&b.length)for(var e=0;e<b.length;e++){var d=
b[e].name;c[d]=1==a&&"undefined"!==typeof this[d]?this[d]:b[e].value}return c},z=function(a){var c=this,b=null,e=y.call(a);this.components&&(b=a.tagName,b=b.charAt(0).toUpperCase()+b.slice(1).toLowerCase(),b=this.components[b],"function"==typeof b&&(a.handler=b));a.getAttribute("@loop")&&!b&&(b=!0,a.parent=a);b&&(a.self={},a.template=a.innerHTML,a.innerHTML="");var d=Object.keys(e);if(d.length)for(var f=0;f<d.length;f++)if(a.handler||"on"!=d[f].substring(0,2)){var h=e[d[f]].replace("self.","");"@ready"==
d[f]?(this.queue.push(Function("self",e[d[f]]).bind(a,this.self)),a.removeAttribute(d[f])):"@ref"==d[f]?(this.self[h]=a.self?a.self:a,a.removeAttribute(d[f])):"@bind"==d[f]?(a.addEventListener("input",function(){var k=c.state,p=h;if("function"===typeof this.val)var n=this.val();else if("SELECT"==this.tagName&&this.getAttribute("multiple")){n=[];for(var q=0;q<this.options.length;q++)this.options[q].selected&&n.push(this.options[q].value)}else n="checkbox"==this.type?this.checked&&this.getAttribute("value")?
this.value:this.checked:this.getAttribute("contenteditable")?this.innerHTML:this.value;k[p]=n;t.call(c,h)}),u.call(this,a,{v:e[d[f]]},"value"),a[d[f]]=h,a.removeAttribute(d[f])):"@loop"==d[f]?(u.call(this,a,{v:e[d[f]]},"@loop"),a.loop=this.self[h],a.removeAttribute(d[f])):(x.call(this,a,d[f]),document.dictionary&&(b=g.translate(e[d[f]]))&&a.setAttribute(d[f],b))}else{let k=d[f].toLowerCase(),p=e[d[f]];a.removeAttribute(k);a.addEventListener(d[f].substring(2),function(n){Function("self","e",p).call(a,
c.self,n)})}if(a.children.length){b=[];for(f=0;f<a.children.length;f++)b.push(a.children[f]);for(f=0;f<b.length;f++)z.call(this,b[f])}else a.textContent&&(x.call(this,a,"textContent"),document.dictionary&&(b=g.translate(a.innerText))&&(a.innerText=b));e=a.handler;"function"===typeof e&&("undefined"==typeof a.loop&&(b=a.parentNode,d=g.setProperties.call(a.self,y.call(a,!0),!0),r(d,"parent",this.self),g.render(e,b,d,a.template,a,c.components)),a.remove())},r=function(a,c,b){Object.defineProperty(a,
c,{enumerable:!1,get:function(){return b}})},B=function(a,c){this.parent||(this.parent=this.parentNode);var b=this.parent,e=this.handler||A;var d=this.template;var f=[];if(a.length)for(let h=0;h<a.length;h++){let k=a[h].el;k||(r(a[h],"parent",c),k=g.render(e,b,a[h],d));f.push(k)}for(;b.children[0];)b.children[0].remove();for(;d=f.shift();)b.appendChild(d)},g={render:function(a,c,b,e,d,f){if(!m(c))return console.log("Not valid DOM"),!1;b||(b={});if("function"==typeof a&&("function"===typeof a&&/^class\s/.test(Function.prototype.toString.call(a))?
(a=new a(b),a=g.element(a.render(e,f),a)):a=a.call(b,e,f),!m(a)))return console.log("Component did not returned a valid DOM"),!1;if("ROOT"==a.tagName)for(;a.firstChild;)d?c.insertBefore(a.firstChild,d):c.appendChild(a.firstChild);else d?c.insertBefore(a,d):c.appendChild(a);v(a,c);return a},element:function(a,c,b){var e={self:c||{},state:{},tracking:{},queue:[]};b&&(e.components=b);if(m(a))c=a;else{a=a.replace(/(<([A-Z]{1}[a-zA-Z0-9_-]+)[^>]*)(\/|\/.{1})>/gm,"$1></$2>");a=a.replace(/<>/gi,"<root>").replace(/<\/>/gi,
"</root>").trim();c=document.createElement("template");c.innerHTML=a;c.content?c=c.content:(c=document.createElement("div"),c.innerHTML=a);if(1<c.childNodes.length){console.error("Single root required");return}c=c.firstChild}z.call(e,c);r(e.self,"refresh",function(d){t.call(e,d)});r(e.self,"el",c);c.lemon=e;return c}};g.template=g.element;g.blender=function(a,c,b){return g.render(g.element(a,c),b,c)};g.apply=function(a,c){g.element(a,c);v(a,a)};g.getProperties=function(a){var c={},b;for(b in a)c[b]=
this[b];return c};g.setProperties=function(a,c){for(var b in a)if(this.hasOwnProperty(b)||c)this[b]=a[b];return this};g.resetProperties=function(a){for(var c in a)this[c]=""};g.get=function(a){return l.container[a]};g.set=function(a,c,b){l.container[a]=c;"function"===typeof c&&!0===b&&(l.container[a].storage=!0,a=window.localStorage.getItem(a))&&(a=JSON.parse(a),c(a))};g.dispatch=function(a,c){var b=l.container[a];"function"===typeof b&&(b(c),!0===b.storage&&window.localStorage.setItem(a,JSON.stringify(c)))};
g.translate=function(a){if("^^["==a.substr(0,3)&&"]^^"==a.substr(-3))return a=a.replace("^^[","").replace("]^^",""),document.dictionary[a]||a};g.component=class{constructor(){}};return g});
