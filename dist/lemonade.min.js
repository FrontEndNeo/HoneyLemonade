(function(q,p){"object"===typeof exports&&"undefined"!==typeof module?module.exports=p():"function"===typeof define&&define.amd?define(p):q.lemonade=p()})(this,function(){var q=function(g){if(g.self&&g.self.queue)for(var k;k=g.self.queue.shift();)k.onload()},p=function(g,k,l){if("children"==l)for(l=0;l<g.children.length;l++)g.children[l].selected=0<=k.indexOf(g.children[l].value);else"checked"==l&&("radio"==g.type?(g.checked=!1,g.value==k&&(g.checked=!0)):g.checked=k?!0:!1)},m={render:function(g,
k,l){if(!(k instanceof Element||k instanceof HTMLDocument))return console.log("DOM element given is not valid"),!1;l||(l={});if("function"==typeof g)try{g=g.call(l)}catch(r){g=new g(l),g=m.template(g.render(),g)}k.appendChild(g);q(g);return g},blender:function(g,k,l){return m.render(m.template(g,k),l,k)},apply:function(g,k){m.template(g,k);q(g)}};m.template=function(){var g=function(a,e){var c=e[a]||"",d=function(){var b;if(b=e.tracking[a])for(var f=0;f<b.length;f++){var h=eval(b[f].v);"value"==b[f].property?
b[f].element.value!=h&&(b[f].element.value=h,"function"==typeof b[f].element.change&&b[f].element.change(h)):"children"==b[f].property||"checked"==b[f].property?p(b[f].element,h,b[f].property):b[f].element[b[f].property]=h}};Array.isArray(e[a])?Array.prototype.refresh=d:Object.defineProperty(e,a,{set:function(b){e.state[a]=b;d(b)},get:function(){return e.state[a]}});e[a]=c;e.tracking[a]=[]},k=function(a,e,c,d){var b=e.v.match(/self\.([a-zA-Z0-9_].*?)*/g);if(b.length){var f=eval(e.v)||"";if("textContent"==
c){var h=document.createTextNode(f);a.childNodes[0]?a.insertBefore(h,a.childNodes[0].splitText(e.p)):a.appendChild(h)}else"children"==c||"checked"==c?(h=a,p(a,f,c)):(h=a,h[c]=f);if(h)for(a=0;a<b.length;a++)f=b[a].replace("self.",""),d.tracking[f]||g(f,d),d.tracking[f].push({element:h,property:c,v:e.v})}},l=function(a,e,c,d){var b=[],f=0;a.getAttribute&&a.getAttribute(c)?a.setAttribute(c,a.getAttribute(c).replace(/\{\{(.*?)\}\}/g,function(h,n,t,u){b.push({p:t-f,v:n});f+=h.length;return""})):"string"==
typeof a[c]&&a[c]&&(a[c]=a[c].replace(/\{\{(.*?)\}\}/g,function(h,n,t,u){b.push({p:t-f,v:n});f+=h.length;return""}));if(b.length)for(1!=b.length||"textContent"!=c||a.innerText||(c="innerHTML"),e=b.length-1;0<=e;e--)k(a,b[e],c,d)},r=function(a,e){var c={};if(a.attributes&&a.attributes.length)for(var d=0;d<a.attributes.length;d++)c[a.attributes[d].name]=a.attributes[d].value;var b=Object.keys(c);if(b.length)for(d=0;d<b.length;d++)if("on"==b[d].substring(0,2)){var f=b[d].toLowerCase(),h=c[b[d]];a.removeAttribute(f);
a.events||(a.events=[]);a[f]=Function("self",h).bind(a,e)}else if(a.events||(a.events=[]),"@ready"==b[d])e.queue.push(a),a.onload=Function("self",c[b[d]]).bind(a,e),a.removeAttribute(b[d]);else if("@ref"==b[d])f=c[b[d]].replace("self.",""),e[f]=a,a.removeAttribute(b[d]);else if("@bind"==b[d]){h=!1;if(1==a.multiple){f="var a = []; for (var i = 0; i < this.options.length; i++) { if (this.options[i].selected) { a.push(this.options[i].value); } } "+c[b[d]]+" = a; "+c[b[d]]+".refresh()";var n="children"}else"checkbox"==
a.type||"radio"==a.type?n="checked":(n="value",h=!0),f=c[b[d]]+("checkbox"==a.type?" = this.checked":" = this.value");a.onchange=Function("self",f).bind(a,e);1==h&&(a.onkeyup=a.onchange);k(a,{v:c[b[d]]},n,e);a.removeAttribute(b[d])}else l(a,c[b[d]],b[d],e);if(a.children.length)for(d=0;d<a.children.length;d++)r(a.children[d],e);else l(a,"innerText","textContent",e);if(a.constructor==HTMLUnknownElement&&(c=a.tagName,c=c.charAt(0).toUpperCase()+c.slice(1).toLowerCase(),c=eval(c),"function"==typeof c)){f=
"true"==a.getAttribute("extended")?e:{};for(d=0;d<a.attributes.length;d++)f[a.attributes[d].name]=a.attributes[d].value;m.render(c,a,f)}};return function(a,e){e||(e={});e.state||(e.state={});e.tracking||(e.tracking={});e.queue=[];if(a instanceof Element||a instanceof HTMLDocument)c=a;else{var c=document.createElement("div");c.innerHTML=a.trim();1==c.childNodes.length&&(c=c.childNodes[0])}r(c,e);c.self=e;return c}}();m.element=m.template;m.component=function(){};return m});