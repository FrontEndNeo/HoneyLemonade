(function(m,n){"object"===typeof exports&&"undefined"!==typeof module?module.exports=n():"function"===typeof define&&define.amd?define(n):m.lemonade=n()})(this,function(){var m=null;document.lemonadejs||(m=document.lemonadejs={queue:[],container:{}});var n=function(a){return a instanceof Element||a instanceof HTMLDocument},B=function(a){return g.element(a,this)},w=function(a,c){var b,e;if(e=a.lemon){if(e.queue)for(;b=e.queue.shift();)m.queue.push(b);"function"==typeof e.self.onload&&m.queue.push(e.self.onload.bind(e.self,
a))}if(document.body.contains(c)&&m&&m.queue&&m.queue.length)for(;b=m.queue.shift();)b()},x=function(a,c,b){if("value"===b)if("function"===typeof a.val)a.val()!=c&&a.val(c);else if("SELECT"==a.tagName&&a.getAttribute("multiple"))for(b=0;b<a.children.length;b++)a.children[b].selected=0<=c.indexOf(a.children[b].value);else"checkbox"==a.type?a.checked=c&&"0"!==c&&"false"!==c?!0:!1:"radio"==a.type?(a.checked=!1,a.value==c&&(a.checked=!0)):a.getAttribute("contenteditable")?a.innerHTML!=c&&(a.innerHTML=
c):a.value=c;else"undefined"!==typeof a[b]||"function"==typeof c||"object"==typeof c?a[b]=c:a.setAttribute(b,c)},u=function(a,c){var b,e;if(b=this.tracking[a]){var d=this.self;for(e=0;e<b.length;e++){var f=b[e].element;var h=eval(b[e].v);var l=b[e].property;"@loop"==l?C.call(f,h,d):f.self?f.self[l]=h:x(f,h,l)}c||"function"!=typeof d.onchange||d.onchange.call(f,a,b,d)}},D=function(a){var c=this,b=!0;Object.defineProperty(this.self,a,{set:function(e){c.state[a]=e;u.call(c,a,b);b=!1},get:function(){return c.state[a]},
configurable:!0,enumerable:!0})},v=function(a,c,b){var e=eval(c.v);"undefined"===typeof e&&(e="");if("textContent"==b){var d=document.createTextNode(e);a.childNodes[0]?a.insertBefore(d,a.childNodes[0].splitText(c.p)):a.appendChild(d)}else"@loop"==b?d=a:(d=a,x(a,e,b));if((a=c.v.match(/self\.([a-zA-Z0-9_].*?)*/g))&&a.length)for(e=0;e<a.length;e++){var f=a[e].replace("self.",""),h=!1,l=this.self[f];"undefined"===typeof l&&(l="");this.tracking[f]||(this.tracking[f]=[],h=!0);this.tracking[f].push({element:d,
property:b,v:c.v});h&&D.call(this,f);this.self[f]=l}},y=function(a,c){var b=[],e=0,d=function(f,h,l,k){b.push({p:l-e,v:h});e+=f.length;return""};a.getAttribute&&a.getAttribute(c)?a.setAttribute(c,a.getAttribute(c).replace(/{{(.*?)}}/g,d)):"string"==typeof a[c]&&a[c]&&(a[c]=a[c].replace(/{{(.*?)}}/g,d));if(b.length)for(1!=b.length||"textContent"!=c||a.innerText||(c="innerHTML"),d=b.length-1;0<=d;d--)v.call(this,a,b[d],c)},z=function(a){var c={},b=this.attributes;if(b&&b.length)for(var e=0;e<b.length;e++){var d=
b[e].name;c[d]=1==a&&"undefined"!==typeof this[d]?this[d]:b[e].value}return c},A=function(a){var c=this,b=null,e=z.call(a);this.components&&(b=a.tagName,b=b.charAt(0).toUpperCase()+b.slice(1).toLowerCase(),b=this.components[b],"function"==typeof b&&(a.handler=b));a.getAttribute("@loop")&&!b&&(b=!0,a.parent=a);b&&(a.self={},a.template=a.innerHTML,a.innerHTML="");var d=Object.keys(e);if(d.length)for(var f=0;f<d.length;f++)if(a.handler||"on"!=d[f].substring(0,2)){var h=e[d[f]].replace("self.","");if("@ready"==
d[f])this.queue.push(Function("self",e[d[f]]).bind(a,this.self)),a.removeAttribute(d[f]);else if("@ref"==d[f])this.self[h]=a.self?a.self:a,a.removeAttribute(d[f]);else if("@bind"==d[f]){var l=function(k,p){var E=this.state;if("function"===typeof k.val)var q=k.val();else if("SELECT"==k.tagName&&k.getAttribute("multiple")){q=[];for(var r=0;r<k.options.length;r++)k.options[r].selected&&q.push(k.options[r].value)}else q="checkbox"==k.type?k.checked&&k.getAttribute("value")?k.value:k.checked:k.getAttribute("contenteditable")?
k.innerHTML:k.value;E[p]=q;u.call(this,p)}.bind(this,a,h);a.addEventListener("input",l);v.call(this,a,{v:e[d[f]]},"value");a[d[f]]=h;a.removeAttribute(d[f])}else"@loop"==d[f]?(v.call(this,a,{v:e[d[f]]},"@loop"),a.loop=this.self[h],a.removeAttribute(d[f])):(y.call(this,a,d[f]),document.dictionary&&(b=g.translate(e[d[f]]))&&a.setAttribute(d[f],b))}else{h=d[f].toLowerCase();let k=e[d[f]];a.removeAttribute(h);a.addEventListener(d[f].substring(2),function(p){Function("self","e",k).call(a,c.self,p)})}if(a.children.length){b=
[];for(f=0;f<a.children.length;f++)b.push(a.children[f]);for(f=0;f<b.length;f++)A.call(this,b[f])}else a.textContent&&(y.call(this,a,"textContent"),document.dictionary&&(b=g.translate(a.innerText))&&(a.innerText=b));e=a.handler;"function"===typeof e&&("undefined"==typeof a.loop&&(b=a.parentNode,d=g.setProperties.call(a.self,z.call(a,!0),!0),t(d,"parent",this.self),g.render(e,b,d,a.template,a,c.components)),a.remove())},t=function(a,c,b){Object.defineProperty(a,c,{enumerable:!1,get:function(){return b}})},
C=function(a,c){this.parent||(this.parent=this.parentNode);var b=this.parent,e=this.handler||B;var d=this.template;var f=[];if(a.length)for(let h=0;h<a.length;h++){let l=a[h].el;l||(t(a[h],"parent",c),l=g.render(e,b,a[h],d));f.push(l)}for(;b.children[0];)b.children[0].remove();for(;d=f.shift();)b.appendChild(d)},g={render:function(a,c,b,e,d,f){if(!n(c))return console.log("Not valid DOM"),!1;b||(b={});if("function"==typeof a&&("function"===typeof a&&/^class\s/.test(Function.prototype.toString.call(a))?
(a=new a(b),a=g.element(a.render(e,f),a)):a=a.call(b,e,f),!n(a)))return console.log("Component did not returned a valid DOM"),!1;if("ROOT"==a.tagName)for(;a.firstChild;)d?c.insertBefore(a.firstChild,d):c.appendChild(a.firstChild);else d?c.insertBefore(a,d):c.appendChild(a);w(a,c);return a},element:function(a,c,b){var e={self:c||{},state:{},tracking:{},queue:[]};b&&(e.components=b);if(n(a))c=a;else{a=a.replace(/(<([A-Z]{1}[a-zA-Z0-9_-]+)[^>]*)(\/|\/.{1})>/gm,"$1></$2>");a=a.replace(/<>/gi,"<root>").replace(/<\/>/gi,
"</root>").trim();c=document.createElement("template");c.innerHTML=a;c.content?c=c.content:(c=document.createElement("div"),c.innerHTML=a);if(1<c.childNodes.length){console.error("Single root required");return}c=c.firstChild}A.call(e,c);t(e.self,"refresh",function(d){u.call(e,d)});t(e.self,"el",c);c.lemon=e;return c}};g.template=g.element;g.blender=function(a,c,b){return g.render(g.element(a,c),b,c)};g.apply=function(a,c){g.element(a,c);w(a,a)};g.getProperties=function(a){var c={},b;for(b in a)c[b]=
this[b];return c};g.setProperties=function(a,c){for(var b in a)if(this.hasOwnProperty(b)||c)this[b]=a[b];return this};g.resetProperties=function(a){for(var c in a)this[c]=""};g.get=function(a){return m.container[a]};g.set=function(a,c,b){m.container[a]=c;"function"===typeof c&&!0===b&&(m.container[a].storage=!0,a=window.localStorage.getItem(a))&&(a=JSON.parse(a),c(a))};g.dispatch=function(a,c){var b=m.container[a];"function"===typeof b&&(b(c),!0===b.storage&&window.localStorage.setItem(a,JSON.stringify(c)))};
g.translate=function(a){if("^^["==a.substr(0,3)&&"]^^"==a.substr(-3))return a=a.replace("^^[","").replace("]^^",""),document.dictionary[a]||a};g.component=class{constructor(){}};return g});
